<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>商品の編集</title>
  </head>
  <body>
    <script src="https://unpkg.com/axios@1.6.7/dist/axios.min.js"></script>
    <h1>商品の編集</h1>
    <label for="name">商品名</label>
    <input
      id="name"
      type="text"
      name="name"
      placeholder="商品名"
      value="<%= product.name%>"
    />
    <label for="price">価格</label>
    <input
      id="price"
      type="number"
      name="price"
      placeholder="価格"
      value="<%= product.price %>"
    />
    <label for="category">カテゴリー</label>
    <select name="category" id="category">
      <% for (let category of categories) { %>
      <option value="<%= category %>" <%= product.category === category ? 'selected' : '' %>><%= category %></option>
      <% } %>
    </select>
    <button>登録</button>
    <br />
    <a href="/products/<%= product._id %>">キャンセル</a>

    <script>
      const button = document.querySelector("button");
      const uname = document.querySelector("#name");
      const price = document.querySelector("#price");
      const category = document.querySelector("#category");
      button.addEventListener("click", async (ev) => {
        ev.preventDefault();
        await axios
          .put(
            "/products/<%= product._id %>",
            {
              name: uname.value,
              price: price.value,
              category: category.value,
            },
            {
              headers: {
                "Content-Type": "application/x-www-form-urlencoded",
              },
            }
          )
          .then((res) => {
            location.href = `/products/${res.data}`;
          });
      });
    </script>
  </body>
</html>
